name: trufi_core_mono
environment:
  sdk: ^3.10.0
  flutter: ">=3.0.0 <4.0.0"

workspace:
  - apps/trufi_core
  - apps/trufi_app
  - apps/example

  # General Packages
  - packages/trufi_core_interfaces
  - packages/trufi_core_storage

  # Feature Packages
  - packages/trufi_core_about
  - packages/trufi_core_maps
  - packages/trufi_core_routing
  - packages/trufi_core_routing_ui
  - packages/trufi_core_search_locations
  - packages/trufi_core_utils
  - packages/trufi_core_base_widgets
  - packages/trufi_core_custom_material

dev_dependencies:
  melos: ^7.3.0
  flutter_lints: ^6.0.0

melos:
  
  command:
    bootstrap:
      runPubGetInParallel: true
      environment:
        sdk: ^3.10.0
        flutter: ">=3.0.0 <4.0.0"
      dev_dependencies:
        flutter_lints: ^6.0.0
  scripts:
    analyze:
      run: flutter analyze --no-fatal-infos
      description: Run Flutter analyze on all packages

    format:
      run: dart format .
      description: Format all Dart files

    test:
      run: flutter test
      description: Run tests for all packages

    gen-l10n:
      run: |
        find . -name "*_en.arb" -path "*/l10n/*" -type f | while read arb; do
          dir=$(dirname "$arb")
          prefix=$(basename "$arb" _en.arb)
          class=$(echo "$prefix" | awk -F_ '{for(i=1;i<=NF;i++) $i=toupper(substr($i,1,1)) substr($i,2)} 1' OFS='')Localizations
          # Find the Flutter project root (directory with pubspec.yaml)
          project_dir="$dir"
          while [ "$project_dir" != "." ] && [ ! -f "$project_dir/pubspec.yaml" ]; do
            project_dir=$(dirname "$project_dir")
          done
          if [ -f "$project_dir/pubspec.yaml" ]; then
            rel_dir=${dir#$project_dir/}
            echo "Generating: $class ($project_dir)"
            (cd "$project_dir" && flutter gen-l10n \
              --arb-dir="$rel_dir" \
              --output-dir="$rel_dir" \
              --template-arb-file="${prefix}_en.arb" \
              --output-localization-file="${prefix}_localizations.dart" \
              --output-class="$class" \
              --no-nullable-getter)
          fi
        done
      description: Generate localizations for all projects and packages
